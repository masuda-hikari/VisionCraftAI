﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿<!-- GOVERNANCE:BEGIN -->
<!--
  このセクションはオーケストレーターによって管理されています。
  手動編集は次回同期時に上書きされます。
  プロジェクト固有の内容は LOCAL セクションに記載してください。
-->

# プロジェクトガバナンス（共通）
継承: O:\Dev\CLAUDE.md → O:\Dev\Work\_orchestrator\CLAUDE.md → このファイル

## 【重要】品質レベルアップ指示（必須遵守）

以下の観点で品質を劇的に向上させること:

### 1. プロダクトクオリティの向上
- 現状は「機能が動く」レベル。サブスク課金に値する「圧倒的品質」を目指す
- 機能の洗練・使いやすさ・安定性を徹底的に追求
- ユーザーが「これにお金を払いたい」と思える特別感

### 2. UI/UX・ユーザー体験の徹底追求
- 自力環境構築不要。ワンクリック/ブラウザで即利用可能に
- 直感的でわかりやすいUI。初見で迷わない設計
- モバイル（iPhone/Android）対応必須
- ランディングページの魅力度向上

### 3. マーケティング視点の導入
- ターゲットユーザーを明確に定義
- 「使いたい・お金を払いたい」を喚起する訴求
- 競合との差別化ポイントを明確に
- ユーザー導線の最適化

### 4. 価格設定・課金モデルの見直し
- 基本機能は無料で提供（フリーミアム）
- 有料プランは「他にない特別な価値」を提供
- 圧倒的品質の機能に対してのみ課金
- ユーザーが「価値がある」と感じる価格設定

### 5. AI/LLMインターフェースの検討
- 音声入力・自然言語での操作対応
- LLM APIを活用したユーザー体験向上
- 「手間を省く」価値の提供

**全ての作業はこの品質向上観点を必ず反映させること**

## 事業継続要件（全プロジェクト必須）

### 1. 会員情報管理・セキュリティ（Webサービス必須）
顧客ID・会員情報を扱う場合、以下を**必須**で実装:
- **ECサービス相当の高度なセキュリティ**: OWASP Top 10対策、WAF、DDoS防御
- **高度なハッキング対策**: ペネトレーションテスト、脆弱性スキャン自動化
- **高度なレジリエンス**: 自動復旧、フェイルオーバー、災害復旧計画
- **情報アクセス権限管理**: RBAC、最小権限原則、監査ログ
- **データ分離**: 流出危険度に応じた物理・論理分離
- **高度なサーバー管理**: 自動パッチ適用、監視、アラート
- **高度なバックエンド・フロントエンド・DB構築**: セキュアなアーキテクチャ

### 2. 本番環境デプロイ自動化
- **ドメイン取得**: 無料ドメイン（例: Freenom, Cloudflare）を自動取得
- **CI/CD完全自動化**: GitHub Actions/GitLab CI等でビルド・テスト・デプロイ
- **インフラ自動プロビジョニング**: Terraform/Pulumi等でIaC
- **人間判断が必要な場合のみ質問**: それ以外はAIが全て自動実行

### 3. カスタマー対応AI自動化
有料サービス提供時は**必須**:
- **AI窓口対応**: チャットボット、メール自動応答
- **エスカレーション判定**: AI対応不可時の人間へのエスカレート基準
- **問い合わせ分析**: 頻出問題の自動検出と改善提案

### 4. 企業規模管理システム
- **統合管理ダッシュボード**: 全サービスの状態・メトリクス一元管理
- **自動監視・アラート**: 異常検知時の自動通知・自動対応
- **スケーラビリティ**: 企業規模の負荷に耐える設計

### 禁止事項
- セキュリティ対策の省略・後回し
- 手動デプロイ（CI/CD必須）
- カスタマー対応の放置
- 監視・ログの欠如

## 開発要件（共通）
### 言語設定
**日本語一律使用**: 応答/コメント/commit全て日本語

### 基本原則
- 抽象化: 共通処理100%/2箇所使用→即共通化/DRY
- 資源活用: 既存確認必須/改良優先

### 禁止事項
- 未テストコミット
- 認証情報ハードコード
- 脆弱性導入
- UTF-8以外のエンコーディング

## ミッション
**AIによる人間代替作業の実行と収益化**

## セッション終了時必須作業
1. 作業記録: logs/claude_runs に保存
2. Git Push: 全変更をコミット＆プッシュ
3. 次回引継ぎ: 未完了タスク・課題を明記

## Orchestrator統制
- logs/claude_runs にログ保存必須
- STATUS.md を最新状態に維持
- 失敗時は failure_classification を設定
<!-- GOVERNANCE:END -->

<!-- LOCAL:BEGIN -->
<!--
  このセクションはプロジェクト固有の内容です。
  オーケストレーター同期時も保持されます。
-->

# VisionCraftAI - プロジェクト固有設定
---

## ミッション

**AIによる人間代替作業の実行と収益化**

本プロジェクトのAIは**プロフェッショナル**として以下を遵守する:
- 収益を得るに相応しい品質の成果物を提出
- 誠実かつ妥協を許さない姿勢
- 批判的観点で自らの成果物を批評・改善

**収益モデル**: 画像生成API・従量販売

---

## プロジェクト概要
**VisionCraftAI** - 最先端AI画像生成の編集プラットフォーム

Google Gemini 3モデルを活用した高品質AI画像生成サービス。プロンプトベースの画像生成と基本的な編集機能を提供。

---

## 技術スタック

| カテゴリ | 技術 |
|----------|------|
| 言語 | Python 3.12+ |
| AIモデル | Google Gemini 3 (Vertex AI) |
| クライアント | google-cloud-aiplatform |
| 画像処理 | Pillow, OpenCV |
| API | FastAPI (将来) |
| テスト | pytest |

---

## モデル統合
### Google Vertex AI / Gemini 3
- **認証**: Google Cloud サービスアカウント認証
- **認証情報**: 環境変数 `GOOGLE_APPLICATION_CREDENTIALS` 経由
- **レート制限**: API使用量監視必須
- **コスト管理**: 呼び出し回数ログ記録

### セキュリティ要件
- ×APIキー/認証情報のハードコード禁止
- ×認証ファイルのGitコミット禁止
- ○環境変数または暗号化設定ファイル使用
- ○`.env`ファイルは`.gitignore`に追加

---

## アーキテクチャ設計
```
VisionCraftAI/
├── src/
│   ├── main.py              # エントリーポイント
│   ├── generator/           # 画像生成モジュール
│   │   ├── gemini_client.py # Gemini API クライアント
│   │   └── prompt_handler.py# プロンプト処理
│   ├── editor/              # 画像編集モジュール
│   │   └── post_processor.py# 後処理
│   └── utils/               # ユーティリティ
│       ├── config.py        # 設定管理
│       └── cache.py         # キャッシュ処理
├── outputs/                 # 生成画像保存先
├── tests/                   # テストスイート
├── docs/                    # ドキュメント
└── .claude/                 # Claude Code設定
```

### コンポーネント
1. **APIサーバー** (将来): FastAPIベースのRESTful API
2. **プロンプトハンドラー**: ユーザー入力の前処理・安全性フィルタリング
3. **画像ポストプロセッサー**: 生成画像の後処理・最適化
4. **キャッシュレイヤー**: 重複リクエストのコスト削減

### 制約条件
- モデル使用コストの監視
- レート制限の遵守
- 不適切コンテンツのフィルタリング必須

---

## 収益化戦略

### ビジネスモデル
| プラン | 内容 | 価格帯 |
|--------|------|--------|
| Free | 月5生成、低解像度 | 無料 |
| Basic | 月100枚、標準解像度 | $9.99/月 |
| Pro | 月500枚、高解像度、優先処理 | $29.99/月 |
| Enterprise | 無制限API アクセス、カスタム | 要見積 |

### 収益源
1. **サブスクリプション**: 月額/年額プラン
2. **従量課金**: クレジット購入システム
3. **Enterprise API**: 第三者アプリ向けAPI提供
4. **プレミア機能**: 高度な編集ツール、バッチ処理

### 将来実装
- ユーザーアカウント管理
- クレジット追跡システム
- 決済統合(Stripe)
- 使用量ダッシュボード

---

## 開発計画

### Phase 1: 基盤構築 (現在)
- [x] プロジェクト構成作成
- [ ] Google Cloud 認証設定
- [ ] Gemini 3 API接続確認

### Phase 2: コア機能
- [ ] `generate_image(prompt)` 関数実装
- [ ] CLI インターフェース作成
- [ ] 基本的なエラーハンドリング

### Phase 3: 品質向上
- [ ] プロンプト安全性フィルター
- [ ] 画像後処理機能
- [ ] キャッシュ機構

### Phase 4: ユーザーインターフェース
- [ ] Webインターフェース (React/Next.js)
- [ ] API エンドポイント

### Phase 5: 収益化
- [ ] ユーザー認証システム
- [ ] クレジット/サブスクリプション管理
- [ ] 決済統合

---

## 実装ステップ詳細

### Step 1: API認証設定
```python
# 環境変数設定
# GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json
# GOOGLE_CLOUD_PROJECT=your-project-id

from google.cloud import aiplatform
aiplatform.init(project="project-id", location="us-central1")
```

### Step 2: 画像生成関数
```python
def generate_image(prompt: str, options: dict = None) -> bytes:
    """
    プロンプトから画像を生成

    Args:
        prompt: 画像生成プロンプト
        options: 生成オプション（解像度、スタイル等）
    Returns:
        生成された画像のバイナリデータ
    """
    # 実装予定
    pass
```

### Step 3: CLIインターフェース
```bash
python src/main.py --prompt "A beautiful sunset over mountains" --output outputs/sunset.png
```

### Step 4: テスト戦略
- サンプルプロンプトでの品質評価
- API呼び出しコストのログ記録
- エラーケースのハンドリング確認

---

## ガイドライン

### コード品質
- 型ヒント必須
- docstring必須
- pytest でのテストカバレッジ80%以上

### セキュリティ
- 入力プロンプトのサニタイズ
- 不適切コンテンツのフィルタリング
- APIキーの安全な管理

### 出力管理
- 生成画像は `outputs/` に保存
- ファイル名 `{timestamp}_{hash}.png`
- メタデータ保存（プロンプト、生成日時）

---

## 禁止事項
- ×APIキーのハードコード
- ×認証ファイルのコミット
- ×未フィルタリングのプロンプト実行
- ×コスト監視なしの大量API呼び出し
- ×テストなしの本番デプロイ

---

## セッション終了時の必須作業

**CRITICAL**: 作業終了前に必ず実行
1. **作業記録**: 変更内容を簡潔に記録（冗長禁止）
2. **Git Push**: 全変更をコミット＆プッシュ
3. **次回引継ぎ**: 未完了タスク・課題を明記

---

## セッション開始チェックリスト
- [ ] このCLAUDE.mdを確認
- [ ] `.claude/CORRECTION_ORDER.md`の有無確認（あれば最優先対応）
- [ ] `.claude/SESSION_REPORT.md`で前回の状況確認
- [ ] README.mdで現状把握
- [ ] 作業計画をTodoWriteで作成

---

## Orchestrator統制（CRITICAL）
### 強制レポート制度

本プロジェクトはOrchestratorの統制下にあり、以下を遵守する:

#### セッション終了時の必須更新
1. **SESSION_REPORT.md**（`.claude/SESSION_REPORT.md`）
   - 収益化進捗の記録
   - 今回の作業内容と収益貢献度
   - 次回推奨アクション
   - 自己評価

2. **REVENUE_METRICS.md**（`.claude/REVENUE_METRICS.md`）
   - 収益状況に変更があれば更新
   - ロードマップ進捗の更新

#### 軌道修正指示への対応
- `.claude/CORRECTION_ORDER.md`が存在する場合は**最優先で対応**
- 対応完了後、ファイルを削除しセッションレポートに記録

### 収益化優先度
| 優先度 | 作業種別 | 例 |
|--------|----------|-----|
| 1（最高） | 直接収益 | 課金機能、販売ページ |
| 2 | 収益準備 | MVP完了、データ蓄積 |
| 3 | 収益基盤 | コア機能、品質向上 |
| 4 | 収益間接 | ドキュメント、テスト |
| 5（最低） | 非収益 | リファクタリングのみ |

**ルール**: 優先度5の作業は収益化完了まで原則禁止

### 逸脱の自己申告
収益化から外れる作業を行う場合:
1. 理由をSESSION_REPORT.mdに記録
2. 収益化への影響を評価
3. 代替案または復帰計画を提示

---

## AI行動原則

### 自発的行動の姿勢
AIは指示待ちではなく、自ら考え、最善を尽くす:
| 原則 | 行動 |
|------|------|
| **自己駆動** | 指示がなくても必要な作業を見つけ発見・提案 |
| **完全責任** | 途中で止めない。完了まで責任を持つ |
| **品質追求** | 「動けばいい」ではなく「収益に値する品質」を追求 |
| **批判的思考** | 自分の成果物を厳しく評価し、欠陥を見つける |
| **透明性** | 不明点・懸念点は隠さず明確にする |

### 怠惰・逸脱の禁止

以下は**絶対禁止**:
- 「後でやる」と言って放置
- 「簡略化のため逸脱」と言って必要な処理をスキップ
- 「時間がないので」と言って品質を落とす
- 確認せずに推測で進める
- エラーを見なかったことにする

---

## 自己批評基準
プロフェッショナルとして、成果物提出前に以下を自問:
| 観点 | チェック |
|------|---------|
| 収益価値 | この成果物に対価を払う価値があるか？ |
| 品質 | 妥協した実装はないか？ |
| 誠実さ | 不明点を少数にしていないか？ |
| 完全性 | 指示された要件を満たしているか？ |
| 継続性 | 次のセッションで引き継げる状態か？ |

**一つでもNoなら、提出前に改善すること**

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-01-05 | Orchestrator共通要件を追加 |
| 2026-01-05 | O:\Dev\CLAUDE.md継承要件を追加 |
| 2026-01-06 | AI行動原則・怠惰禁止・継続性観点を追加 |
| 2026-01-06 | Orchestrator統制要件を追加 |

<!-- LOCAL:END -->

<!--
Orchestrator管理タグ（編集禁止）
TEMPLATE_VERSION: 2.0
LAST_SYNC: 2026-01-07
ORCHESTRATOR_MANAGED: true
-->
